提案パターン1：H1順張り（構造）＋M5プルバック反転（構造）＋EMAで初動確認
使う意図：いちばん素直で、パラメーター群とも噛み合いが良い。

フィルター（共通ゲート）

スプレッド：MaxSpreadPips 以下

約定滑り：SlipAllowancePips（IncludeSlipAllowanceInSizing=trueならサイズにも加味）

時間帯：TradeStartTimeJst〜TradeEndTimeJst のみ。ForceFlatTimeJst で強制フラット

ニュース：UseNewsBacktest2025 / UseNewsForwardFRED 有効時は MinutesBeforeNews〜MinutesAfterNews は禁止

ボラ環境：EnableAtrEnvGate=true のとき AtrEnvPeriod の ATR が AtrEnvMinPips〜AtrEnvMaxPips 内のみ

H1（環境/ダウ判定）

H1 HighLowでトレンド判定：HH/HL なら上、LL/LH なら下

トレンド不明（直近で交互・同値多い等）はノートレ（DirectionDeadzonePips で“方向無効域”を作る）

M5（方向とタイミング）

方向：H1と同方向のみ

タイミング：M5が逆行波を作った後に「同方向の構造転換」を出した瞬間で入る
例（H1上）：M5でLL/LH→HL/HHに転換（“HL確定→直近LHを上抜け”）

EMA確認（任意だが強い）：EntryTypeEmaCross=true
価格がEmaPeriodを同方向にクロスし、CrossCandleMinBodyPips を満たす足でのみ許可

SL（構造ベース固定）

SLは短期足の構造：直近のM5 HL/LHの外側

バッファ：RiskBufferPips を上乗せ

さらに安全にするなら：MinSlAtrPeriod / MinSlAtrMult で “最低SL幅” をATRで下限化

TP（暫定）

まずは TPを固定しない場合：UseTimeStop=true、MaxHoldMinutes で時間撤退

置くなら：TpAtrPeriod / TpAtrMult のATR TP（暫定）

RR条件：EnableMinRrRelax=true なら MinRrRelaxWindowBars と MinRrRelaxedRatio を使って「最低RRを状況で緩和」

提案パターン2：H1で構造転換（ブレイク）検出＋M5リテスト（1回目のみ）
使う意図：大きい流れの切り替わりを取りに行く。勝ちが伸びやすい。

H1（転換検出）

下降→上昇転換：直近LH（戻り高値）を上抜けで“転換”

上昇→下降転換：直近HL（押し安値）を下抜けで“転換”

転換直後は “初回リテストだけ” を狙う（MaxPositions も抑えやすい）

M5（リテスト条件）

ブレイクしたH1水準にM5が戻ってきて、そこでM5が同方向のHL/LHを形成したらエントリー

EntryMaxDistancePips / ReapproachWindowBars / ReapproachMaxDistancePips を使って「離れすぎた追いかけ」と「再接近だけ」を明確化

DirectionStateMinHoldBars で“方向状態”の最低維持を作り、転換直後のブレを弾く

SL

M5のリテスト安値/高値の外側＋RiskBufferPips

TP（暫定）

伸ばす前提なので、TpAtrMult を大きめ or TimeStop緩め（TrendDisableTimeStopInTrend があるならトレンド中は時間停止を無効化）

提案パターン3：H1順張り固定＋M5“押し/戻りの深さ”をフィボで規格化して入る
使う意図：フィボを使うなら一番筋が良い（裁量のブレが減る）。

H1

パターン1と同じ（ダウで方向固定）

フィボの定義

H1の直近推進波（HL→HH もしくは LH→LL）を取り、その押し/戻りを 38.2–61.8% を基本許可ゾーンにする

61.8%超は“押し深すぎ”で見送り（転換リスク上昇）

M5

フィボ許可ゾーンに入った後、M5で構造転換（HL/HH or LH/LL）＋（任意）EMAクロス確認

EntryMode や EnableCOREMode があるなら、「フィボ＋構造」成立時のみ EntryMode を有効化するイメージ（コード上は if 条件で抑制）

SL

M5構造SL（同上）

TP（暫定）

フィボを使うなら “1:1到達で一部利確” などが相性良いが、TP未定なら当面は TpAtrMult で代用し、あとでフィボ拡張（127.2/161.8）に置換可能

提案パターン4：H1は環境判定だけ（トレンド/レンジ）＋M5で方向決定（短期主導）
使う意図：「5分足レベルのHighLowで方向判断」を最優先したい場合。H1は“取引して良い環境か”に限定。

H1（環境）

H1がレンジ/低ボラなら禁止：EnableAtrEnvGate と AtrEnvMinPips を強めに

H1が明確トレンドなら許可：DirectionDeadzonePips を小さめにして方向が出やすいように

M5（方向＝最優先）

M5ダウが上（HH/HL）なら買い、下（LL/LH）なら売り

タイミングは「直近のブレイク（直近LH/HLの更新）」＋（任意）EMAクロス

逆方向のポジション抑制：EnableCOREEntrySuppressionStructure があるなら “構造反転までは逆張り禁止” に割り当て

SL

M5構造SL（必須）

TP（暫定）

方向が短期主導なので、UseTimeStop と MaxHoldMinutes を主にして回転させる運用と相性が良い

運用上の注意（このパラメ群を“全部使える”前提での最適解）

まずは「パターン1」か「パターン2」を土台にすると、ATRゲート・ニュース・時間帯・スプレッド・再接近（Reapproach）・RR緩和（MinRrRelax）が全部きれいに入ります。

TP未定の間は、TpAtrPeriod/TpAtrMult と UseTimeStop/MaxHoldMinutes の組み合わせで “とりあえず回る” 状態にして、勝ちパターンが固まってから TPを構造 or フィボ拡張に置換するのが崩れにくいです。

次に決めるとCODEXが実装しやすい確認事項は1つだけ。
「M5の“構造転換トリガー”をどれに固定するか」です（例：HL確定＋直近LHブレイク、EMAクロス必須、など）。どれに寄せたい？

Feb 16 2026 - 04:49:43
レンジ戦略はどのように考えていますか。
Feb 16 2026 - 04:49:45

レンジをやるなら、まず前提を分けます。

①「レンジを避ける」EAなのか
②「レンジを取りにいく」EAなのか

あなたの構造（H1で環境、M5でエントリー）なら、レンジも戦略化できます。
以下、HighLowベースで組む場合の設計案です。

前提：レンジの定義（H1）

まずレンジ判定を明確にする必要があります。

H1で以下のどれかを満たす場合をレンジと定義：

・直近スイングが HH/HL でも LL/LH でもなく、交互が続く
・直近高値と安値の更新幅が DirectionDeadzonePips 未満
・ATRが AtrEnvMinPips 未満（低ボラレンジ）
・H1の直近2波の振幅が平均より著しく小さい

ここを曖昧にするとレンジ戦略は破綻します。

レンジ戦略パターン1
「H1ボックス内でM5反転を取る」

H1でレンジ確定後：

・直近H1高値＝レンジ上限
・直近H1安値＝レンジ下限

M5でやること：

上限付近に来たら
→ M5で LH → LL への転換を確認して売り

下限付近に来たら
→ M5で HL → HH への転換を確認して買い

フィボは使わない方が安定します（レンジ内では機能が弱い）。

SL：
M5構造の外側（直近LH/HLの外）

TP：
レンジ中央 or 反対側のH1境界手前

これは最も素直なレンジ逆張り。

レンジ戦略パターン2
「レンジ上限下限でのみトレード」

中央では絶対入らない。

条件：

・価格がH1レンジ上限±EntryMaxDistancePips以内
・または下限±EntryMaxDistancePips以内

M5で構造転換確認後のみエントリー。

中央ゾーンは“ノートレ領域”として明確に定義。

この方式は勝率が上がる代わりに回数が減る。

レンジ戦略パターン3
「フェイクブレイク狙い」

H1レンジと判断した状態で、

上限を少しブレイク
→ M5で構造が即逆転（LH形成）
→ 売り

下限を少し割る
→ M5で即HL形成
→ 買い

いわゆるストップ狩り型。

この場合：

・ReapproachWindowBars
・ReapproachMaxDistancePips

が活きる。

SLはブレイク高値/安値の外側。

RRは取りやすい。

レンジ戦略パターン4
「ATR圧縮→拡散初動」

ATRが低下（AtrEnvMinPips近辺）
＋H1がレンジ

その後、M5で構造ブレイクが出たら
順張りで“レンジ脱出”を取る。

これは逆張りではなく“レンジ終焉戦略”。

あなたの構造に最も合うのは？

今の設計（H1環境＋M5構造）なら、

・トレンド時 → 順張り
・レンジ時 → H1ボックス逆張り（パターン1）

の切替型が一番自然。

重要

レンジ戦略をやるなら必ず決めること：

中央ゾーンを取るか取らないか

レンジ幅の最小条件（狭すぎると死ぬ）

トレンド判定とレンジ判定の優先順位

ここを曖昧にすると両方崩れます。

もし本気でレンジも入れるなら、
次はこれを決めるべきです：

「レンジ時は逆張りのみ？
それともレンジ脱出初動も狙う？」

どちらを主軸にする？